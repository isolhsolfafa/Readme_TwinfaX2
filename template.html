<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>$title$</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    <!-- Mermaid CSS -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
        }
        @media (max-width: 767px) {
            .markdown-body {
                padding: 15px;
            }
        }
        /* ì¶”ê°€ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        .markdown-body h1 {
            border-bottom: 3px solid #4285f4;
            padding-bottom: 10px;
        }
        .markdown-body img[alt*="badge"] {
            margin: 2px;
        }
        /* Mermaid ë‹¤ì´ì–´ê·¸ë¨ ìŠ¤íƒ€ì¼ */
        .mermaid {
            text-align: center;
            margin: 20px 0;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            background: #f8f9fa;
        }
        /* ë””ë²„ê¹…ìš© ìŠ¤íƒ€ì¼ */
        .debug-info {
            background: #fffbdd;
            border: 1px solid #e6db55;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <article class="markdown-body">
        $body$
    </article>
    
    <!-- Mermaid ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        console.log('ğŸš€ Mermaid ë””ë²„ê¹… ëª¨ë“œ ì‹œì‘');
        
        // Mermaid ì´ˆê¸°í™”
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose'
        });

        function debugAndConvertMermaid() {
            console.log('ğŸ” ì „ì²´ HTML ë¶„ì„ ì‹œì‘...');
            
            // 1. ì „ì²´ HTML ë‚´ìš© í™•ì¸
            const bodyHTML = document.body.innerHTML;
            console.log('ğŸ“„ ì „ì²´ HTML ê¸¸ì´:', bodyHTML.length);
            
            // 2. ëª¨ë“  í…ìŠ¤íŠ¸ ë…¸ë“œ ê²€ì‚¬
            function getAllTextNodes(node) {
                let textNodes = [];
                if (node.nodeType === 3) { // TEXT_NODE
                    textNodes.push(node);
                } else {
                    for (let child of node.childNodes) {
                        textNodes.push(...getAllTextNodes(child));
                    }
                }
                return textNodes;
            }
            
            const allTextNodes = getAllTextNodes(document.body);
            console.log('ğŸ“ ì´ í…ìŠ¤íŠ¸ ë…¸ë“œ ìˆ˜:', allTextNodes.length);
            
            // 3. Mermaid íŒ¨í„´ì´ ìˆëŠ” í…ìŠ¤íŠ¸ ë…¸ë“œ ì°¾ê¸°
            let foundNodes = [];
            allTextNodes.forEach((node, index) => {
                const text = node.textContent.trim();
                if (text.includes('graph TB') || text.includes('graph LR') || text.includes('subgraph') || text.includes('pie title')) {
                    console.log(`ğŸ¯ í…ìŠ¤íŠ¸ ë…¸ë“œ ${index}ì—ì„œ Mermaid ë°œê²¬:`, text.substring(0, 100));
                    foundNodes.push({node, text, index});
                }
            });
            
            // 4. ì½”ë“œ ë¸”ë¡ ê²€ì‚¬
            const codeBlocks = document.querySelectorAll('code, pre');
            console.log('ğŸ”§ ì½”ë“œ ë¸”ë¡ ìˆ˜:', codeBlocks.length);
            
            let mermaidBlocks = [];
            codeBlocks.forEach((block, index) => {
                const text = block.textContent.trim();
                console.log(`ğŸ“‹ ì½”ë“œ ë¸”ë¡ ${index} (${text.length} chars):`, text.substring(0, 100));
                
                if (text.includes('graph TB') || text.includes('graph LR') || text.includes('subgraph') || text.includes('pie title')) {
                    console.log(`âœ… ì½”ë“œ ë¸”ë¡ ${index}ì—ì„œ Mermaid ë°œê²¬!`);
                    mermaidBlocks.push({block, text, index});
                }
            });
            
            // 5. ë””ë²„ê¹… ì •ë³´ë¥¼ í˜ì´ì§€ì— í‘œì‹œ
            const debugDiv = document.createElement('div');
            debugDiv.className = 'debug-info';
            debugDiv.innerHTML = `
                <strong>ğŸ” Mermaid ë””ë²„ê¹… ì •ë³´:</strong><br/>
                - ì´ í…ìŠ¤íŠ¸ ë…¸ë“œ: ${allTextNodes.length}ê°œ<br/>
                - Mermaid í¬í•¨ í…ìŠ¤íŠ¸ ë…¸ë“œ: ${foundNodes.length}ê°œ<br/>
                - ì´ ì½”ë“œ ë¸”ë¡: ${codeBlocks.length}ê°œ<br/>
                - Mermaid í¬í•¨ ì½”ë“œ ë¸”ë¡: ${mermaidBlocks.length}ê°œ<br/>
                - ë¸Œë¼ìš°ì €: ${navigator.userAgent}
            `;
            document.body.insertBefore(debugDiv, document.body.firstChild);
            
            // 6. ë³€í™˜ ì‹œë„
            let converted = 0;
            
            // í…ìŠ¤íŠ¸ ë…¸ë“œ ë³€í™˜
            foundNodes.forEach(({node, text}) => {
                try {
                    const mermaidDiv = document.createElement('div');
                    mermaidDiv.className = 'mermaid';
                    mermaidDiv.textContent = text;
                    
                    // ë¶€ëª¨ ìš”ì†Œì— ì¶”ê°€
                    if (node.parentNode) {
                        node.parentNode.insertBefore(mermaidDiv, node);
                        node.parentNode.removeChild(node);
                        converted++;
                        console.log('âœ… í…ìŠ¤íŠ¸ ë…¸ë“œ ë³€í™˜ ì„±ê³µ');
                    }
                } catch (err) {
                    console.error('âŒ í…ìŠ¤íŠ¸ ë…¸ë“œ ë³€í™˜ ì‹¤íŒ¨:', err);
                }
            });
            
            // ì½”ë“œ ë¸”ë¡ ë³€í™˜
            mermaidBlocks.forEach(({block, text}) => {
                try {
                    const mermaidDiv = document.createElement('div');
                    mermaidDiv.className = 'mermaid';
                    mermaidDiv.textContent = text;
                    
                    // pre íƒœê·¸ ì•ˆì˜ codeì¸ ê²½ìš° preë¥¼ êµì²´
                    if (block.parentElement && block.parentElement.tagName === 'PRE') {
                        block.parentElement.parentNode.replaceChild(mermaidDiv, block.parentElement);
                    } else {
                        block.parentNode.replaceChild(mermaidDiv, block);
                    }
                    converted++;
                    console.log('âœ… ì½”ë“œ ë¸”ë¡ ë³€í™˜ ì„±ê³µ');
                } catch (err) {
                    console.error('âŒ ì½”ë“œ ë¸”ë¡ ë³€í™˜ ì‹¤íŒ¨:', err);
                }
            });
            
            console.log(`ğŸ¯ ì´ ${converted}ê°œ ë¸”ë¡ ë³€í™˜ ì™„ë£Œ`);
            
            // 7. Mermaid ë Œë”ë§
            if (converted > 0) {
                setTimeout(() => {
                    mermaid.run().then(() => {
                        console.log('âœ¨ Mermaid ë Œë”ë§ ì„±ê³µ!');
                        // ì„±ê³µ ì‹œ ë””ë²„ê¹… ì •ë³´ ì—…ë°ì´íŠ¸
                        debugDiv.innerHTML += '<br/>âœ… Mermaid ë Œë”ë§ ì™„ë£Œ!';
                    }).catch(err => {
                        console.error('âŒ Mermaid ë Œë”ë§ ì‹¤íŒ¨:', err);
                        debugDiv.innerHTML += `<br/>âŒ ë Œë”ë§ ì‹¤íŒ¨: ${err.message}`;
                    });
                }, 200);
            } else {
                debugDiv.innerHTML += '<br/>âŒ ë³€í™˜í•  Mermaid ë¸”ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            }
        }

        // ì—¬ëŸ¬ ì‹œì ì—ì„œ ì‹¤í–‰
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', debugAndConvertMermaid);
        } else {
            debugAndConvertMermaid();
        }

        window.addEventListener('load', () => {
            setTimeout(debugAndConvertMermaid, 1000);
        });

        // ìµœí›„ì˜ ìˆ˜ë‹¨
        setTimeout(debugAndConvertMermaid, 3000);
    </script>
</body>
</html>
